og.addTask = {    /**     * 初始化时间控件     */    initDate: function () {        var datePicker = new og.DateField({            renderTo: 'task-due-date',            name: 'task-date-picker',            id: 'task-date-picker',            value: '',            editable: false,            readOnly: true        });    },    /**     * 初始化科室选择     */    initDepartCombo: function (id,usersStore) {        var data = [];        var keyMap = {};        // 转为控件需要的格式        for (var i = 0; i < usersStore.length; i++) {            var temp = [usersStore[i].depart_id, usersStore[i].depart_name];            data.push(temp);            // 建立一个科室和id的映射            keyMap[temp[1]] = temp[0];        }        og.addTask.departMap = keyMap;        var store = new Ext.data.SimpleStore({            fields: ['key', 'value'],            data: data        });        var depCombo = new Ext.form.ComboBox({            renderTo: id,            name: 'departCombo',            id: 'departCombo'+id,            value: '',            store: store,            displayField: 'value',            valueField: 'key',            hiddenName: 'task-depart-id',            typeAhead: true,            mode: 'local',            triggerAction: 'all',            selectOnFocus: true,            width: 100,            tabIndex: '150',            valueField: 'value',            emptyText: ( '请选择科室...'),            valueNotFoundText: '',            listeners: {                expand: function () {                    this.list.setWidth(this.width);                }            },            editable: false,            readOnly: true        });        //depCombo.on('select', og.onAssignToComboSelect);    },    submit: function () {        var params = {};        params.title = $('#task-name-input').val();        params.detail = $('#task-detail-input').val();        params.dueDate = $('#task-date-picker').val();        params.depart = og.addTask.departMap[$('#task-depart-id').val()];        params.id = $('#add-task-taskid').html();        var valiresult = og.addTask.validateInput(params);        if (valiresult != '') {            $('#add-task-tip').html(valiresult);            return;        }else{            $('#add-task-tip').html('');        }        var opt = 'add';        if (params.id != '') {            opt = 'edit';        }        var url = og.getUrl('newtask', 'add_task', {opt: opt});        og.openLink(url, {            method: 'POST',            post: params,            callback: function (success, data) {                if (success && !data.errorCode) {                    Ext.MessageBox.alert("提示", "创建成功！");                } else {                    if (!data.errorMessage || data.errorMessage == '')                        og.err(lang("error task delay apply"));                }            },            scope: this        });    },    lawTasksubmit: function () {        var params = {};        params.content = Ext.getCmp('depart-law-task-content2').getValue();        params.depart = og.addTask.departMap[$('#task-depart-id').val()];        var opt = 'add';        var url = og.getUrl('newtask2', 'add_law_task', {opt: opt});        og.openLink(url, {            method: 'POST',            post: params,            callback: function (success, data) {                if (success && !data.errorCode) {                    Ext.MessageBox.alert("提示", "创建成功！");                } else {                    if (!data.errorMessage || data.errorMessage == '')                        og.err(lang("error add law task"));                }            },            scope: this        });    },    departTasksubmit: function () {        var params = {};        params.content = Ext.getCmp('depart-task-content3').getValue();        params.depart = og.addTask.departMap[$('#task-depart-id').val()];        var opt = 'add';        var url = og.getUrl('newtask3', 'add_depart_task', {opt: opt});        og.openLink(url, {            method: 'POST',            post: params,            callback: function (success, data) {                if (success && !data.errorCode) {                    Ext.MessageBox.alert("提示", "创建成功！");                } else {                    if (!data.errorMessage || data.errorMessage == '')                        og.err(lang("error add depart task"));                }            },            scope: this        });    },    /**     * 验证新建任务输入的合法性     */    validateInput: function (params) {        if ($.trim(params.title) == '') {            return '请输入岗位职责';        }        if ($.trim(params.detail) == '') {            return '请输入目标任务';        }        if ($.trim(params.dueDate) == '') {            return '请选择到期时间';        }        var now = new Date();        var nowYear = now.getFullYear();        var nowMonth = now.getMonth()+1;        var nowDate = now.getDate();        var nowDate = nowYear + '-' + nowMonth + '-' + nowDate;        if (new Date(nowDate).getTime() >= new Date($.trim(params.dueDate)).getTime()) {            return '到期时间必须大于当前时间';        }        return '';    },    /**     * 验证新建法定职责     */    validateLawInput: function (params) {        if ($.trim(params.content) == '') {            return '请输入法定职责';        }        return '';    },    fillTaskField: function (task) {        if (!task) {            return;        }        $('#add-task-taskid').html(task.id);        $('#task-name-input').val(task.title);        $('#task-detail-input').html(task.text);        Ext.getCmp("task-date-picker").setValue(task.due_date.split(' ')[0]);        Ext.getCmp("departCombotask-due-depart").setValue(task.depart_name);    }}