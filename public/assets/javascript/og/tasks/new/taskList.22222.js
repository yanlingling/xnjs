og.taskList = {    addTaskClick: function () {        var url = og.getUrl('newtask', 'add_task');        og.openLink(url, {post: {}});    },    /**     * 编辑任务     */    viewTaskClick: function (id) {        var url = og.getUrl('newtask', 'add_task', {'opt': 'view'});        og.openLink(url, {post: {taskId: id}});    },    /**     * 查看任务详情     * @param id     */    viewTaskDetailClick: function (id) {        var ele = $("#task-more-detail" + id);        if (ele.is(":visible")) {            ele.hide(500);        } else {            ele.show(500);        }    },    /**     * 取消查看详情     * @param id     */    viewTaskDetailCancelClick: function (id) {        var ele = $("#task-more-detail" + id);        ele.hide(500);    },    completeClick: function (task_id) {       var win = new Ext.Window({            title:'完成',            width:400,            height:300,            closeAction:'hide',            plain:true,            layout:'form',            autoDestroy : true,            items:[{                layout:'form',                style:'padding:8px;',                baseCls:'x-plain',                items:[{                    layout:'form',                    columnWidth:0.5,                    baseCls:'x-plain',                    labelWidth:100,                    items:[{                        xtype:"textarea",                        name:'complete-datail',                        fieldLabel:"请输入完成情况",                        width:250,                        height:100                    }                    ]                }]            }],            buttonAlign:'center',            buttons:[{                text:'确定',                handler:function(btn){                  // var value = Ext.getCmp('complete-datail').getValue();                    var value = win.getComponent(0).getComponent(0).getValue();                    console.log(win.getComponent(0).getComponent(0));                    if($.trim(value) == ''){                        Ext.MessageBox.alert('请输入岗位职责的完成情况描述');                      //  $('#complete-datail-error').html('请输入岗位职责的完成情况描述').show();                        return ;                    }                    Ext.MessageBox.confirm('', '您确认该任务已经完成了吗？系统将会随机决定是否要进行督察', function (btn) {                        if (btn == 'yes') {                            og.taskList.completeTask(task_id, value);                            win.hide();                        }                    });                }            },{                text:'取消',                handler:function(btn){                    win.hide();                    console.log(Ext.getCmp('complete-datail'));                    //Ext.getCmp('complete-datail-error').hide();                }            }],            listeners:{                'show':function(){                   // Ext.getDom('image').src='User.gif';                }            }        });        win.show();    },    completeTask: function (task_id, txt) {        og.openLink(og.getUrl('newtask', 'complete_task', {id: task_id, quick: true}), {            method: 'POST',            post: {detail: txt},            callback: function (success, data) {                if (!success || data.errorCode) {                } else {                    Ext.getCmp('tasks-panel').reload();                }            },            scope: this        });    },    drawDelayApply: function (id) {        // 框已经有了，隐藏        var box = $('#delayApplyBox' + id);        if (box.length > 0) {            if (box.is(':visible')) {                $('#delayApplyBox' + id).hide(500);            } else {                $('#delayApplyBox' + id).show(500);            }            return;        }        var sb = new StringBuffer();        sb.append('<div id="delayApplyBox' + id + '" class="hide ogAppendBox">延期原因(少于100字)：<textarea id="delay-reason"></textarea>'            + '<div>申请延期：<input style="width: 30px" id="delay-day"/>&nbsp;天</div>'            + '<span class="small-button" onclick="og.taskList.submitTaskDelayApply(' + id + ')">提交</span>'            + '&nbsp;&nbsp;'            + '<span class="small-button" onclick="og.taskList.submitTaskDelayApplyCancel(' + id + ')">关闭</span>'            + '<span class="error-tip" id="delayApply' + id + '"></span>'            // + '<input type="button" value="关闭 " onclick=" "/>'            + '</div>');        $(sb.toString()).insertAfter('#task-list-' + id)        $('#delayApplyBox' + id).show(500);    },    submitTaskDelayApplyCancel: function (id) {        $('#delayApplyBox' + id).hide(500);    },    // 提交延期的申请    submitTaskDelayApply: function (task_id) {        var parameters = {            taskId: task_id,            reason: document.getElementById('delay-reason').value,            hopeDay: document.getElementById('delay-day').value,            departId: $('#depart_id').html()        };        var res = this.checkTaskDelayApplyInput(parameters);        if (res != '') {            $('#delayApply' + task_id).html(res);            return;        }        else {            $('#delayApply' + task_id).html('');        }        var url = og.getUrl('newtask', 'task_delay_apply', {id: task_id});        og.openLink(url, {            method: 'POST',            post: parameters,            callback: function (success, data) {                if (success && !data.errorCode) {                    Ext.MessageBox.alert("提示", "申请已创建成功，请等待处理结果");                    Ext.getCmp('tasks-panel').reload();                    og.closeTaskDelayApply();                } else {                    if (!data.errorMessage || data.errorMessage == '')                        og.err(lang("error task delay apply"));                }            },            scope: this        });    },    /**     * 检查延期申请的输入是否合法     * @param parameters     */    checkTaskDelayApplyInput: function (parameters) {        if ($.trim(parameters.reason) == '') {            return '请输入申请延期的原因';        }        if (getStrLength(parameters.reason) > 200) {            return '延期原因输入过长';        }        if (!$.isNumeric(parameters.hopeDay)) {            return '申请天数必须是数字';        }        return '';    },    /**     * 跳转到科室的任务     * @param depart_id     */    goToDepartTask: function (depart_id) {        var url = og.getUrl('newtask', 'new_list_tasks', {depart_id: depart_id, tab: 'task'});        og.openLink(url, {});    },    /**     * 跳转到科室的延期申请     * @param depart_id     */    goToDepartApply: function (depart_id) {        var url = og.getUrl('newtask', 'new_list_tasks', {depart_id: depart_id, tab: 'apply'});        og.openLink(url, {});    },    /**     * 同意延期申请     * @param id     * @param task_id     */    agreeDelayApply: function (id, task_id) {        var parameters = {            agreeDay: document.getElementById('agree-day-' + id).value,            taskId: task_id        };        if (!$.isNumeric(parameters.agreeDay)) {            $('#edit-apply-tip').html('同意延期的天数必须是数字');            return;        }        var url = og.getUrl('newtask', 'agree_delay_apply', {id: id});        og.openLink(url, {            method: 'POST',            post: parameters,            callback: function (success, data) {                if (success && !data.errorCode) {                    Ext.MessageBox.alert("提示", "操作成功");                    Ext.getCmp('tasks-panel').reload();                } else {                    if (!data.errorMessage || data.errorMessage == '')                        og.err(lang("error task delay apply"));                }            },            scope: this        });    },    /**     * 不同意的处理     * @param id     * @param task_id     */    disagreeDelayApply: function (id, task_id) {        var url = og.getUrl('newtask', 'disagree_delay_apply', {id: id});        og.openLink(url, {            method: 'POST',            callback: function (success, data) {                if (success && !data.errorCode) {                    Ext.MessageBox.alert("提示", "操作成功");                    Ext.getCmp('tasks-panel').reload();                } else {                    if (!data.errorMessage || data.errorMessage == '')                        og.err(lang("error task delay apply"));                }            },            scope: this        });    },    /**     * 点击督察通过     * @param task_id     */    passSupervise: function (task_id) {        var url = og.getUrl('newtask', 'pass_supervise', {id: task_id});        og.openLink(url, {            method: 'POST',            callback: function (success, data) {                if (success && !data.errorCode) {                    Ext.MessageBox.alert("提示", "操作成功");                    Ext.getCmp('tasks-panel').reload();                } else {                    if (!data.errorMessage || data.errorMessage == '')                        og.err(lang("error pass_supervise"));                }            },            scope: this        });    },    /**     * 点击督察不通过     * @param task_id     */    rejectSupervise: function (task_id, due_date) {        var url = og.getUrl('newtask', 'reject_supervise', {id: task_id});        og.openLink(url, {            method: 'POST',            post: {                due_date: due_date            },            callback: function (success, data) {                if (success && !data.errorCode) {                    Ext.MessageBox.alert("提示", "操作成功");                    Ext.getCmp('tasks-panel').reload();                } else {                    if (!data.errorMessage || data.errorMessage == '')                        og.err(lang("error reject_supervise"));                }            },            scope: this        });    }};