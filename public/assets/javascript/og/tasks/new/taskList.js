og.taskList = {    addTaskClick: function () {        var url = og.getUrl('newtask', 'add_task');        og.openLink(url, {post: {}});    },    viewAllTaskClick: function () {        var url = og.getUrl('newtask', 'new_list_tasks_of_juzhang');        og.openLink(url, {post: {}});    },    addLawTask: function () {        var url = og.getUrl('newtask2', 'add_law_task');        og.openLink(url, {post: {}});    },    addDepartTask: function () {        var url = og.getUrl('newtask3', 'add_depart_task');        og.openLink(url, {post: {}});    },    /**     * 编辑任务     */    viewTaskClick: function (id) {        var url = og.getUrl('newtask', 'add_task', {'opt': 'view'});        og.openLink(url, {post: {taskId: id}});    },    /**     * 查看任务详情     * @param id     */    viewTaskDetailClick: function (id) {        var ele = $("#task-more-detail" + id);        if (ele.is(":visible")) {            ele.hide(500);        } else {            ele.show(500);        }    },    /**     * 取消查看详情     * @param id     */    viewTaskDetailCancelClick: function (id) {        var ele = $("#task-more-detail" + id);        ele.hide(500);    },    completeClick: function (task_id,supervise_status,adv_supervise_status) {        var config = {            title: "",            msg: "请简要描述该岗位职责的完成情况：",            width: 400,            multiline: true,            closable: true,            buttons: Ext.MessageBox.OKCANCEL,            fn: function (btn, txt) {                if (btn == 'ok') {                    Ext.MessageBox.confirm('', '您确认该职责已经完成了吗？系统将会随机决定是否要进行督察', function (btn) {                        if (btn == 'yes') {                            og.taskList.completeTask(task_id, txt,supervise_status,adv_supervise_status);                        }                    });                }            }        };        Ext.MessageBox.show(config);    },    completeTask: function (task_id, txt, supervise_status, adv_supervise_status) {        og.openLink(og.getUrl('newtask', 'complete_task', {id: task_id, quick: true}), {            method: 'POST',            post: {                detail: txt,                supervise_status: supervise_status,                adv_supervise_status: adv_supervise_status            },            callback: function (success, data) {                if (!success || data.errorCode) {                } else {                    Ext.getCmp('tasks-panel').reload();                }            },            scope: this        });    },    beginAdvancedSupervise: function (task_id) {        og.openLink(og.getUrl('newtask', 'advanced_supervise', {id: task_id}), {            method: 'POST',            callback: function (success, data) {                if (!success || data.errorCode) {                } else {                    Ext.getCmp('tasks-panel').reload();                }            },            scope: this        });    },    deleteClick: function (task_id) {        Ext.MessageBox.confirm('', '您确认删除该任务吗？', function (btn) {            if (btn == 'yes') {                og.openLink(og.getUrl('newtask', 'delete_task', {id: task_id, quick: true}), {                    method: 'POST',                    callback: function (success, data) {                        if (!success || data.errorCode) {                        } else {                            Ext.getCmp('tasks-panel').reload();                        }                    },                    scope: this                });            }        });    },    drawDelayApply: function (id) {        // 框已经有了，隐藏        var box = $('#delayApplyBox' + id);        if (box.length > 0) {            if (box.is(':visible')) {                $('#delayApplyBox' + id).hide(500);            } else {                $('#delayApplyBox' + id).show(500);            }            return;        }        var sb = new StringBuffer();        sb.append('<div id="delayApplyBox' + id + '" class="hide ogAppendBox">延期原因(少于100字)：<textarea id="delay-reason"></textarea>'            + '<div>申请延期：<input style="width: 30px" id="delay-day"/>&nbsp;天</div>'            + '<span class="small-button" onclick="og.taskList.submitTaskDelayApply(' + id + ')">提交</span>'            + '&nbsp;&nbsp;'            + '<span class="small-button" onclick="og.taskList.submitTaskDelayApplyCancel(' + id + ')">关闭</span>'            + '<span class="error-tip" id="delayApply' + id + '"></span>'            // + '<input type="button" value="关闭 " onclick=" "/>'            + '</div>');        $(sb.toString()).insertAfter('#task-list-' + id)        $('#delayApplyBox' + id).show(500);    },    submitTaskDelayApplyCancel: function (id) {        $('#delayApplyBox' + id).hide(500);    },    // 提交延期的申请    submitTaskDelayApply: function (task_id) {        var parameters = {            taskId: task_id,            reason: document.getElementById('delay-reason').value,            hopeDay: document.getElementById('delay-day').value,            departId: $('#depart_id').html()        };        var res = this.checkTaskDelayApplyInput(parameters);        if (res != '') {            $('#delayApply' + task_id).html(res);            return;        }        else {            $('#delayApply' + task_id).html('');        }        var url = og.getUrl('newtask', 'task_delay_apply', {id: task_id});        og.openLink(url, {            method: 'POST',            post: parameters,            callback: function (success, data) {                if (success && !data.errorCode) {                    Ext.MessageBox.alert("提示", "申请已创建成功，请等待处理结果");                    Ext.getCmp('tasks-panel').reload();                    og.closeTaskDelayApply();                } else {                    if (!data.errorMessage || data.errorMessage == '')                        og.err(lang("error task delay apply"));                }            },            scope: this        });    },    /**     * 检查延期申请的输入是否合法     * @param parameters     */    checkTaskDelayApplyInput: function (parameters) {        if ($.trim(parameters.reason) == '') {            return '请输入申请延期的原因';        }        if (getStrLength(parameters.reason) > 200) {            return '延期原因输入过长';        }        if (!$.isNumeric(parameters.hopeDay)) {            return '申请天数必须是数字';        }        return '';    },    /**     * 跳转到科室的任务     * @param depart_id     */    goToDepartTask: function (depart_id) {        var url = og.getUrl('newtask', 'new_list_tasks', {depart_id: depart_id, tab: 'task'});        og.openLink(url, {});    },    /**     * 跳转到科室的延期申请     * @param depart_id     */    goToDepartApply: function (depart_id) {        var url = og.getUrl('newtask', 'new_list_tasks', {depart_id: depart_id, tab: 'apply'});        og.openLink(url, {});    },    /**     * 同意延期申请     * @param id     * @param task_id     */    agreeDelayApply: function (id, task_id) {        var parameters = {            agreeDay: document.getElementById('agree-day-' + id).value,            taskId: task_id        };        if (!$.isNumeric(parameters.agreeDay)) {            $('#edit-apply-tip').html('同意延期的天数必须是数字');            return;        }        var url = og.getUrl('newtask', 'agree_delay_apply', {id: id});        og.openLink(url, {            method: 'POST',            post: parameters,            callback: function (success, data) {                if (success && !data.errorCode) {                    Ext.MessageBox.alert("提示", "操作成功");                    Ext.getCmp('tasks-panel').reload();                } else {                    if (!data.errorMessage || data.errorMessage == '')                        og.err(lang("error task delay apply"));                }            },            scope: this        });    },    /**     * 不同意的处理     * @param id     * @param task_id     */    disagreeDelayApply: function (id, task_id) {        var url = og.getUrl('newtask', 'disagree_delay_apply', {id: id});        og.openLink(url, {            method: 'POST',            callback: function (success, data) {                if (success && !data.errorCode) {                    Ext.MessageBox.alert("提示", "操作成功");                    Ext.getCmp('tasks-panel').reload();                } else {                    if (!data.errorMessage || data.errorMessage == '')                        og.err(lang("error task delay apply"));                }            },            scope: this        });    },    /**     * 点击督察通过     * @param task_id     */    passSupervise: function (task_id) {        var config = {            title: "",            msg: "请填写督察意见：",            width: 400,            multiline: true,            closable: true,            buttons: Ext.MessageBox.OKCANCEL,            fn: function (btn, txt) {                if (btn == 'ok') {                    var url = og.getUrl('newtask', 'pass_supervise', {id: task_id});                    og.openLink(url, {                        method: 'POST',                        post: {                            feedback: txt                        },                        callback: function (success, data) {                            if (success && !data.errorCode) {                                Ext.MessageBox.alert("提示", "操作成功");                                Ext.getCmp('tasks-panel').reload();                                Ext.getCmp('overview-panel').reload();                            } else {                                if (!data.errorMessage || data.errorMessage == '')                                    og.err(lang("error pass_supervise"));                            }                        },                        scope: this                    });                }            }};        Ext.MessageBox.show(config);    },    passAdvancedSupervise: function (task_id) {        var config = {            title: "",            msg: "请填写督察意见：",            width: 400,            multiline: true,            closable: true,            buttons: Ext.MessageBox.OKCANCEL,            fn: function (btn, txt) {                if (btn == 'ok') {                    var url = og.getUrl('newtask', 'pass_adv_supervise', {id: task_id});                    og.openLink(url, {                        method: 'POST',                        post: {                            feedback: txt                        },                        callback: function (success, data) {                            if (success && !data.errorCode) {                                Ext.MessageBox.alert("提示", "操作成功");                                Ext.getCmp('tasks-panel').reload();                            } else {                                if (!data.errorMessage || data.errorMessage == '')                                    og.err(lang("error pass_supervise"));                            }                        },                        scope: this                    });                }            }}        Ext.MessageBox.show(config);    },    /**     * 点击督察不通过     * @param task_id     */    rejectSupervise: function (task_id, due_date, depart_id) {        var config = {            title: "",            msg: "请填写督察意见：",            width: 400,            multiline: true,            closable: true,            buttons: Ext.MessageBox.OKCANCEL,            fn: function (btn, txt) {                if (btn == 'ok') {                    var url = og.getUrl('newtask', 'reject_supervise', {id: task_id});                    og.openLink(url, {                        method: 'POST',                        post: {                            due_date: due_date,                            assigned_to_departid: depart_id,                            feedback: txt                        },                        callback: function (success, data) {                            if (success && !data.errorCode) {                                Ext.MessageBox.alert("提示", "操作成功");                                Ext.getCmp('tasks-panel').reload();                            } else {                                if (!data.errorMessage || data.errorMessage == '')                                    og.err(lang("error reject_supervise"));                            }                        },                        scope: this                    });                }            }        };        Ext.MessageBox.show(config);    },    rejectAdvancedSupervise: function (task_id, due_date, depart_id, rand_supervise_status) {        var config = {            title: "",            msg: "请填写督察意见：",            width: 400,            multiline: true,            closable: true,            buttons: Ext.MessageBox.OKCANCEL,            fn: function (btn, txt) {                if (btn == 'ok') {                    var url = og.getUrl('newtask', 'reject_adv_supervise', {id: task_id});                    og.openLink(url, {                        method: 'POST',                        post: {                            due_date: due_date,                            assigned_to_departid: depart_id,                            random_status: rand_supervise_status,                            feedback: txt                        },                        callback: function (success, data) {                            if (success && !data.errorCode) {                                Ext.MessageBox.alert("提示", "操作成功");                                Ext.getCmp('tasks-panel').reload();                            } else {                                if (!data.errorMessage || data.errorMessage == '')                                    og.err(lang("error reject_supervise"));                            }                        },                        scope: this                    });                }            }        };        Ext.MessageBox.show(config);    },    deliverClick: function(id){        if($('.ogAppendBox2').is(':visible')){            //只能有一个框            $('.ogAppendBox2').hide(500);            setTimeout(function(){$('.ogAppendBox2').remove();},500);            return;        }        // 框已经有了，隐藏        var box = $('#delayApplyBox' + id);        if (box.length > 0) {            if (box.is(':visible')) {                $('#delayApplyBox' + id).hide(500);                setTimeout(function(){$('#delayApplyBox' + id).remove();},500);            } else {                $('#delayApplyBox' + id).show(500);            }            return;        }        var now= new Date();        var year=now.getFullYear();        var month=now.getMonth();        var date=now.getDate();        var time = year+'-'+(month+1)+'-'+date;        var deparA = $('#depart_id').html()==1?'':'<option value="1">效能办</option>';        var deparB = $('#depart_id').html()==2?'':'<option value="2">办公室</option>';        var deparC = $('#depart_id').html()==3?'':'<option value="3">稽查科</option>';        var deparD = $('#depart_id').html()==4?'':'<option value="4">流通监管二科</option>';        var deparE = $('#depart_id').html()==5?'':'<option value="5">药械二科</option>';        var deparF = $('#depart_id').html()==6?'':'<option value="6">流通监管一科</option>';        var deparG = $('#depart_id').html()==7?'':'<option value="7">法制科</option>';        var deparL = $('#depart_id').html()==8?'':'<option value="8">局长室</option>';        var sb = new StringBuffer();        sb.append('<div id="delayApplyBox' + id + '" class="hide ogAppendBox2 ogAppendBox">转交理由(少于100字)：<textarea id="delay-reason"></textarea>'        + '<div>转交时间：<input style="width: 65px" id="delay-day" readonly="readonly" value="'+time+'"/>&nbsp;&nbsp;'        + '转交部门：<select id="depar">'+'<option value="0">请选择部门</option>'        + deparA + deparB + deparC + deparD + deparE + deparF + deparG + deparL        + '</select>'        +'</div>'        + '<span class="small-button" onclick="og.taskList.submitDeliver(' + id + ')">提交</span>'        + '&nbsp;&nbsp;'        + '<span class="small-button" onclick="og.taskList.submitTaskDelayApplyCancel(' + id + ')">关闭</span>'        + '<span class="error-tip" id="delayApply' + id + '"></span>'            // + '<input type="button" value="关闭 " onclick=" "/>'        + '</div>');        $(sb.toString()).insertAfter('#task-list-' + id)        $('#delayApplyBox' + id).show(500);    },    //提交任务转交    submitDeliver:function(task_id){        var parameters = {            taskId: task_id,            reason: document.getElementById('delay-reason').value,            hopeDay: document.getElementById('delay-day').value,            departId: document.getElementById('depar').value        };//departId: $('#depart_id').html()        if(parameters.reason == ''){            $('#delayApply'+task_id).html('请输入转交的理由');            return;        }        if(parameters.departId == '0'){            $('#delayApply'+task_id).html('请请选择转交部门');            return;        }        //return;        var url = og.getUrl('newtask', 'task_deliver', {id: task_id});        og.openLink(url, {            method: 'POST',            post: parameters,            callback: function (success, data) {                if (success && !data.errorCode) {                    Ext.MessageBox.alert("提示", "已转交成功");                    Ext.getCmp('tasks-panel').reload();                    og.closeTaskDelayApply();                } else {                    if (!data.errorMessage || data.errorMessage == '')                        og.err(lang("error task delay apply"));                }            },            scope: this        });    },    submitTaskDelayApplyCancel: function (id) {        $('#delayApplyBox' + id).hide(500);    }};